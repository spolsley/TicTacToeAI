<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Tic Tac Toe AI</title>
		<meta charset="utf-8">
		<style type="text/css">
			#gameboard {
				position:relative;
				height:300px;
				width:300px;
				margin-left:auto;
				margin-right:auto;
			}
			.space {
				position:absolute;
				margin:0px;
				padding:0px;
				height:100px;
				width:100px;
				font-size:24px;
				text-align:center;
				line-height:100px;
				border-width:0px;
				border-style:solid;
				border-color:black;
			}
			#S0 { top:0px; left:0px; border-right-width:1px; border-bottom-width:1px; }
			#S1 { top:0px; left:100px; border-bottom-width:1px; }
			#S2 { top:0px; left:200px; border-left-width:1px; border-bottom-width:1px; }
			#S3 { top:100px; left:0px; border-right-width:1px;}
			#S4 { top:100px; left:100px; }
			#S5 { top:100px; left:200px; border-left-width:1px; }
			#S6 { top:200px; left:0px; border-right-width:1px; border-top-width:1px; }
			#S7 { top:200px; left:100px; border-top-width:1px; }
			#S8 { top:200px; left:200px; border-left-width:1px; border-top-width:1px; }
		</style>
		<script type="text/javascript">
			var end = false;
			var turn = 0;
			var plays = [0,1,2,3,4,5,6,7,8];
			var playerSide = "X";
			var computerSide = "O";
			var showProb = false;
			function userPlay(id) {
				if ((id.innerHTML != "") || (end)) return;
				id.innerHTML = playerSide;
				plays[id.id[1]] = playerSide;
				turn++;
				var winner = endgame(plays);
				if (winner == "") {
					if (turn >= 9) {
						alert("Draw!");
						end = true;
					}
					else computerPlay();
				}
				else {
					alert(winner + " wins!");
					end = true;
				}
				return;
			}
			function computerPlay() {
				if (end) return;
				var move = ai(plays,computerSide,computerSide,true);
				document.getElementById("S" + move).innerHTML = computerSide;
				plays[move] = computerSide;
				turn++;
				var winner = endgame(plays);
				if (winner == "") {
					if (turn >= 9) {
						alert("Draw");
						end = true;
					}
				}
				else {
					alert(winner + " wins!");
					end = true;
				}
				return;
			}
			function ai(state,player,currPlayer,topLevel) {
				var availableMoves = [];
				for (var i = 0; i < 9; i++) {
					if (state[i] == i) availableMoves.push(i);
				}
				if (availableMoves.length == 0) {
					var winner = endgame(state);
					if (winner == player) return 1;
					else if (winner == "") return 0;
					else return -1;
				}
				var moves = ["n","n","n","n","n","n","n","n","n"];
				for (var j = 0; j < availableMoves.length; j++) {
					var nextPlayer = "";
					var nextState = state.slice(0);
					if (currPlayer == "X") nextPlayer = "O";
					else nextPlayer = "X";
					nextState[availableMoves[j]] = currPlayer;
					var winner = endgame(nextState);
					if (!topLevel) {
						if (winner == player) {return 1;}
						else if (winner == "") {
							moves[availableMoves[j]] = ai(nextState,player,nextPlayer,false);
						}
						else {return -1;}
					}
					else {
						if (winner == player) {return availableMoves[j];}
						else {moves[availableMoves[j]] = ai(nextState,player,nextPlayer,false);}
					}
				}
				if (!topLevel) {
					var weight = 0;
					for (var k = 0; k < 9; k++) {
						if (moves[k] != "n")
							weight = weight + moves[k];
					}
					return weight / availableMoves.length;
				}
				else {
					var max = -2;
					var index = availableMoves[0];
					for (var l = 0; l < 9; l++) {
						if (moves[l] != "n") {
							if (showProb) {
								document.getElementById("S" + l).style.backgroundColor = "rgba(0,"+Math.round((moves[l]+1)/2*255)+",0,0.5)";
							}
							else {
								document.getElementById("S" + l).style.backgroundColor = "rgba(0,0,0,0)";
							}
							if (moves[l] >= max) {
								max = moves[l];
								index = l;
							}
						}
						else {
							document.getElementById("S" + l).style.backgroundColor = "rgba(0,0,0,0)";
						}
					}
					return index;
				}
			}
			function endgame(state) {
				var winner = "";
				this.equal = function (x,y,z) {
					if ((state[x] == state[y]) && (state[y] == state[z])) return true;
					else return false;
				}
				if (this.equal(0,1,2)) {winner = state[0];}
				else if (this.equal(0,3,6)) {winner = state[0];}
				else if (this.equal(0,4,8)) {winner = state[0];}
				else if (this.equal(1,4,7)) {winner = state[1];}
				else if (this.equal(2,5,8)) {winner = state[2];}
				else if (this.equal(2,4,6)) {winner = state[2];}
				else if (this.equal(3,4,5)) {winner = state[3];}
				else if (this.equal(6,7,8)) {winner = state[6];}
				return winner;
			}
			function toggleProb() {
				if (showProb) showProb = false;
				else showProb = true;
			}
			function computerBegin() {
				if (turn == 0) computerPlay();
				else return;
			}
		</script>
	</head>
	<body>
		<div id="gameboard">
			<div class="space" id="S0" onclick="userPlay(this)"></div>
			<div class="space" id="S1" onclick="userPlay(this)"></div>
			<div class="space" id="S2" onclick="userPlay(this)"></div>
			<div class="space" id="S3" onclick="userPlay(this)"></div>
			<div class="space" id="S4" onclick="userPlay(this)"></div>
			<div class="space" id="S5" onclick="userPlay(this)"></div>
			<div class="space" id="S6" onclick="userPlay(this)"></div>
			<div class="space" id="S7" onclick="userPlay(this)"></div>
			<div class="space" id="S8" onclick="userPlay(this)"></div>
		</div>
		<div style="position:fixed;top:10px;left:10px;">
			<button type="button" onclick="computerBegin()">Computer Play First</button><br><br>
			<input type="checkbox" onclick="toggleProb()"> Show Probabilities
		</div>
	</body>
</html>
